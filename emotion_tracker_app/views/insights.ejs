<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insightful Emotions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"
        integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
</head>

<body>
        <!--Navigation bar-->
<div id="nav-placeholder" class="container">

</div>

<script>
$(function(){
  $("#nav-placeholder").load("/html/navbar.html");
});
</script>
<!--end of Navigation bar-->

<main>
    <h1 id="insights-title">Insights</h1>

    <h5 id="stats">At-A Glance</h5>

    <h6 id="snapshot-no">Total number of snapshots created: <%= noSnapshots %>
    </h6>



        <div style="position: relative; height:40vh; width:80vw" class="container">
            <canvas id="barchart" width="600px" height="250px" style="background-color: white;"></canvas>
        </div>


    </div>

   
    <div id="top3_triggers" class="container">
        <table id="top3_triggers_table">
            <tr>
                <th colspan="2">Top 3 Contextual Triggers</th>
            </tr>
            <tr>
                <td> <em>Trigger:</em></td>
                <td> <em>Mentioned in:</em></td>
            </tr>
            <tr>
                <td>
                    <%= topTriggers[0].trigger %>
                </td>
                <td>
                    <%= topTriggers[0].count %> snapshots
                </td>
            </tr>
            <tr>
                <td>
                    <%= topTriggers[1].trigger %>
                </td>
                <td>
                    <%= topTriggers[1].count %> snapshots
                </td>
            </tr>
            <tr>
                <td>
                    <%= topTriggers[2].trigger %>
                </td>
                <td>
                    <%= topTriggers[2].count %> snapshots
                </td>
            </tr>
        </table>
    </div>

    <h5 id="compare">Comparison vs Average Emotion Intensities</h5>

    <div class="trigger-class" class="container">
        <table>
            <tr>
                <th colspan="2">When "<%= topTriggers[0].trigger%>" is mentioned </th>
            </tr>
            <tr>
                <th colspan="2"><br></th>
            </tr>
            <tr>
                <td>Anger</td>
                <td>
                    <%= formattedTrig1Averages.ang %>
                </td>
            </tr>
            <tr>
                <td>Contempt</td>
                <td>
                    <%= formattedTrig1Averages.cont %>
                </td>
            </tr>
            <tr>
                <td>Disgust</td>
                <td>
                    <%= formattedTrig1Averages.disg %>
                </td>
            </tr>
            <tr>
                <td>Enjoyment</td>
                <td>
                    <%= formattedTrig1Averages.enj %>
                </td>
            </tr>
            <tr>
                <td>Fear</td>
                <td>
                    <%= formattedTrig1Averages.fear %>
                </td>
            </tr>
            <tr>
                <td>Sadness</td>
                <td>
                    <%= formattedTrig1Averages.sad %>
                </td>
            </tr>
            <tr>
                <td>Surprise</td>
                <td>
                    <%= formattedTrig1Averages.surp %>
                </td>
            </tr>
        </table>
    </div>

    <div class="trigger-class" class="container">
        <table>
            <tr>
                <th colspan="2">When "<%= topTriggers[1].trigger%>" is mentioned </th>
            </tr>
            <tr>
                <th colspan="2"><br></th>
            </tr>
            <tr>
                <td>Anger</td>
                <td>
                    <%= formattedTrig2Averages.ang %>
                </td>
            </tr>
            <tr>
                <td>Contempt</td>
                <td>
                    <%= formattedTrig2Averages.cont %>
                </td>
            </tr>
            <tr>
                <td>Disgust</td>
                <td>
                    <%= formattedTrig2Averages.disg %>
                </td>
            </tr>
            <tr>
                <td>Enjoyment</td>
                <td>
                    <%= formattedTrig2Averages.enj %>
                </td>
            </tr>
            <tr>
                <td>Fear</td>
                <td>
                    <%= formattedTrig2Averages.fear %>
                </td>
            </tr>
            <tr>
                <td>Sadness</td>
                <td>
                    <%= formattedTrig2Averages.sad %>
                </td>
            </tr>
            <tr>
                <td>Surprise</td>
                <td>
                    <%= formattedTrig2Averages.surp %>
                </td>
            </tr>
        </table>
    </div>

    <div class="trigger-class" class="container">
        <table>
            <tr>
                <th colspan="2">When "<%= topTriggers[2].trigger%>" is mentioned </th>
            </tr>
            <tr>
                <th colspan="2"><br></th>
            </tr>
            <tr>
                <td>Anger</td>
                <td>
                    <%= formattedTrig3Averages.ang %>
                </td>
            </tr>
            <tr>
                <td>Contempt</td>
                <td>
                    <%= formattedTrig3Averages.cont %>
                </td>
            </tr>
            <tr>
                <td>Disgust</td>
                <td>
                    <%= formattedTrig3Averages.disg %>
                </td>
            </tr>
            <tr>
                <td>Enjoyment</td>
                <td>
                    <%= formattedTrig3Averages.enj %>
                </td>
            </tr>
            <tr>
                <td>Fear</td>
                <td>
                    <%= formattedTrig3Averages.fear %>
                </td>
            </tr>
            <tr>
                <td>Sadness</td>
                <td>
                    <%= formattedTrig3Averages.sad %>
                </td>
            </tr>
            <tr>
                <td>Surprise</td>
                <td>
                    <%= formattedTrig3Averages.surp %>
                </td>
            </tr>
        </table>
    </div>

    </div>


    <div class="container">
        <h5 id="emot-title">Emotion Tracker</h5>
        <div style="position: relative; height:60vh; width:90vw" class="container">
            <canvas id="linechart" width="800px" height="350px" style="background-color: white";></canvas>
        </div>



    </div>

</main>

    <script>


        //bar chart set up and config

        const xlabels = ["Anger", "Contempt", "Disgust", "Enjoyment", "Fear", "Sadness", "Surprise"];
        const avEmotionData = [`<%= emotionAverages.ang %>`, `<%= emotionAverages.cont %>`, `<%= emotionAverages.disg %>`,
            `<%= emotionAverages.enj %>`, `<%= emotionAverages.fear %>`, `<%= emotionAverages.sad %>`, `<%= emotionAverages.surp %>`];

        const labels = xlabels;
        const chartdata = {
            labels: labels,
            datasets: [{
                axis: 'x',
                data: avEmotionData,
                backgroundColor: [
                    'rgba(207, 0, 15, 0.8)',
                    'rgba(112, 128, 144, 0.8)',
                    'rgba(107, 142, 35, 0.8)',
                    'rgba(255, 223, 0, 0.8)',
                    'rgba(0, 0, 139, 0.8)',
                    'rgba(70, 130, 180, 0.8)',
                    'rgba(255, 165, 0, 0.8)'
                ]
            }]
        };

        const barconfig = {
            type: 'bar',
            data: chartdata,
            options: {
                indexAxis: 'x',
                responsive: true,
                animation: true,
                maintainAspectRatio: true,
                scales: { y: { min: 0, max: 10 }, y: {grid: {display: false}}, x: {grid: {display:false }}},
                plugins: {
                    legend: { display: false },
                    tooltips: { enabled: true },
                    title: {
                        display: true,
                        text: "Average Emotion Intensities",
                        font: { size: 16 }
                    }
                }

            }
        };


        // line chart set up and config- help from ChatGPT

        const linelabels = extractAllDateTimeCreated(JSON.parse(`<%- JSON.stringify(apiData) %>`));

        function extractAllDateTimeCreated(data) {
            let allDateTimeCreated = [];

            data.forEach(item => {
                // Iterate over each object in the 'snap' array of the item
                item.snap.forEach(snapItem => {
                    // Assuming each snapItem has a 'datetime_created' property
                    if (snapItem.title) {
                        allDateTimeCreated.push(snapItem.title);
                    }
                });
            });

            return allDateTimeCreated;
        }

        const angerData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'ang');
        const contemptData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'cont');
        const disgustData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'disg');
        const enjoymentData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'enj');
        const fearData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'fear');
        const sadnessData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'sad');
        const surpriseData = extractEmotionIntensities(JSON.parse(`<%- JSON.stringify(apiData) %>`), 'surp');

        function extractEmotionIntensities(data, emotionKey) {
            let allIntensities = [];

            data.forEach(item => {
                item[emotionKey].forEach(emotionItem => {
                    // Extract the 'intensity' property from each emotion item
                    allIntensities.push(emotionItem.intensity);
                });
            });

            return allIntensities;
        }

        const linedata = {
            labels: linelabels,
            datasets: [{
                label: 'Anger',
                data: angerData,
                fill: false,
                borderColor: 'rgb(207, 0, 15, 0.8)',
                backgroundColor: 'rgb(207, 0, 15, 0.8)',
                tension: 0.1
            },
            {
                label: 'Contempt',
                data: contemptData,
                fill: false,
                borderColor: 'rgb(112, 128, 144, 0.8)',
                backgroundColor:'rgb(112, 128, 144, 0.8)',
                tension: 0.1
            },
            {
                label: 'Disgust',
                data: disgustData,
                fill: false,
                borderColor: 'rgb(107, 142, 35, 0.8)',
                backgroundColor: 'rgb(107, 142, 35, 0.8)',
                tension: 0.1
            },
            {
                label: 'Enjoyment',
                data: enjoymentData,
                fill: false,
                borderColor: 'rgb(255, 223, 0, 0.8)',
                backgroundColor: 'rgb(255, 223, 0, 0.8)',
                tension: 0.1
            },
            {
                label: 'Fear',
                data: fearData,
                fill: false,
                borderColor: 'rgb(0, 0, 139, 0.8)',
                backgroundColor: 'rgb(0, 0, 139, 0.8)',
                tension: 0.1
            },
            {
                label: 'Sadness',
                data: sadnessData,
                fill: false,
                borderColor: 'rgb(70, 130, 180, 0.8)',
                backgroundColor: 'rgb(70, 130, 180, 0.8)',
                tension: 0.1
            },
            {
                label: 'Surprise',
                data: surpriseData,
                fill: false,
                borderColor: 'rgb(255, 165, 0, 0.8)',
                backgroundColor: 'rgb(255, 165, 0, 0.8)',
                tension: 0.1
            }

        ]
        };
    

        const lineconfig = {
            type: 'line',
            data: linedata,
            options: {
                legend: {labels: { boxWidth:0, usePointStyle: true}},
                responsive: true,
                animation: true,
                maintainAspectRatio: true,
                scales: { y: { min: 0, max: 10 }, y: {grid: {display: false}}},
                plugins: {
                    legend: { display: true },
                    tooltips: { enabled: false },
                    title: {
                        display: true,
                        text: "Average Intensities",
                        font: { size: 16 }
                    }
                }

            }
        };


        const barChart = new Chart('barchart', barconfig);
        const lineGraph = new Chart('linechart', lineconfig);
    </script>

<script src="/js/insights.js"></script>
</body>

</html>